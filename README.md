  
# Story-Generation

  
## Project overview

<div align="justify">  
StorIA is an app for tablets that will use children's drawing and brief textual prompts and offer a story fitting for it. The child will draw a sketch (and optionally input a prompt), from which the app will offer an improved version of the drawing, painted and colored, and a description narrating it. The amount of text can be selected accordingly knowing the age of the target audience. 

Since our device will use multiple drawings, it can be made together by different kids to create a story made by all of them, in a way that each kid contributes by adding a new page to the story. One of the main objectives is to have the children do stories in groups so they can play with their friends or arrive to meet new ones. 

Lastly, StorIA will have the option to share your story on an internal social page. This network will have a collection of stories created by kids from all around the world. This way, even if a kid doesn't want to draw, they could read all of the posted stories, and connect with children abroad through those. The internal network will also implement a ranking system where kids can rank the stories they have read and StorIA will award the best stories of the month with some sort of prize, yet to be decided.
</div>


## Repository Structure

The repository has the following structure:
- `/Design APP`:  This directory contains an overview of how the application would look like.
- `/Design APP`: This directory contains an overview of how the application would look like.
- `/Examples`: Contains a folder with the original sketch and the image generated from it.
- `/Sketches`: Some example sketches that can be used with the ImageGenerator script.
- `DrawSketch.py`: File with the source code for the tkinter interface, that enables a user to draw and save a sketch using a simple tool box.
- `ImageGenerator.py`: Main file that contains the logic of the application. It defines the code necessary for creating the Gradio application and contains the functions that call the auxiliary models, namely: Sketch2Image, Image2History.
- `TextGenerator.ipynb`: Testing of BLIP-2 to describe the image.
- `environment.yml`: The environment required to execute the code of the different files.


### Models

- **Sketch2Image**: [StableDiffusionXL](https://huggingface.co/docs/diffusers/api/pipelines/controlnet_sdxl) with [ControlNet](https://huggingface.co/docs/diffusers/using-diffusers/controlnet) and a [Variational Auto-Encoder](https://huggingface.co/docs/diffusers/api/models/autoencoderkl)
- **Image2Text**: [Blip2](https://huggingface.co/docs/transformers/model_doc/blip-2)
- **Text2Text**: [Mistral](https://huggingface.co/mistralai/Mistral-7B-v0.1)




## Installation and Usage

Before starting clone the repository:

```
git clone https://github.com/joanlafuente/Story-Generation/tree/main
```
And then create a conda environment with the following command:
```
conda env create -f environment.yml
```

### Executing the gradio interface

Execute the Image generator which will launch the gradio interface. The interface will be hosted in your local machine. The IP will be printed in the command line.


## Example page generation:
In the left image you can see an example of a posible sketch, and in the right the image generated by our application, conditioned with the text  "A horse in a field"

 <div align="center">
  <figure style="display: inline-block; text-align: center;">
    <img src="https://github.com/joanlafuente/Story-Generation/blob/main/Examples/Example%201/sketch.png" alt="Sketch" width="400"/>
  </figure>
  <figure style="display: inline-block; text-align: center;">
    <img src="https://github.com/joanlafuente/Story-Generation/blob/main/Examples/Example%201/gen_image.png" alt="Generated image" width="400"/>
  </figure>
</div>

The text generator make the following text: 


